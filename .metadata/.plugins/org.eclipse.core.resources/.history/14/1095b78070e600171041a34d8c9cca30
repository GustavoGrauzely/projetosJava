package br.com.grauzely.acc.view;

import java.io.File;
import java.io.IOException;
import java.net.URL;
import java.time.LocalDate;
import java.util.Date;
import java.util.List;
import java.util.ResourceBundle;

import javax.xml.parsers.ParserConfigurationException;

import org.xml.sax.SAXException;

import javafx.collections.FXCollections;
import javafx.collections.ObservableList;
import javafx.fxml.FXML;
import javafx.fxml.Initializable;
import javafx.scene.control.Button;
import javafx.scene.control.ComboBox;
import javafx.scene.control.ListView;
import javafx.scene.control.ProgressBar;
import javafx.scene.control.TableColumn;
import javafx.scene.control.TableView;
import javafx.scene.control.TextArea;
import javafx.scene.control.TextField;
import javafx.scene.control.DatePicker;
import javafx.stage.DirectoryChooser;
import javafx.stage.Stage;
import br.com.grauzely.acc.MainApp;
import br.com.grauzely.acc.controller.ArquivoManagerBean;
import br.com.grauzely.acc.model.Log;
import br.com.grauzely.acc.model.ServiceRequests;

public class GerarPatchAccController implements Initializable {

	@FXML
	private TextField origem;
	@FXML
	private TextField destino;
	@FXML
	private Button btnOrigem;
	@FXML
	private Button btnDestino;
	@FXML
	private ListView<Log> listaViewLogs;
	@FXML
	private ProgressBar barra;
	@FXML
	private Button btnGerarPatch;
	@FXML
	private Button btnResetar;

	private MainApp mainApp;
	private Stage dialogOraclePatchStage;
	private ObservableList<Log> listalog = FXCollections.observableArrayList();
	

	public void setMainApp(MainApp mainApp) {
		this.mainApp = mainApp;
	}

	public void setDialogOraclePatchStage(Stage dialogOraclePatchStage) {
		this.dialogOraclePatchStage = dialogOraclePatchStage;
	}

	@Override
	public void initialize(URL location, ResourceBundle resources) {
		// TODO Auto-generated method stub

	}

	public void buscarOrigem() {
		DirectoryChooser directoryChooser = new DirectoryChooser();
		directoryChooser.setTitle("Escolha um diretório de origem...");
		File file = directoryChooser.showDialog(null);
		if (file != null) {
			origem.setText(file.getAbsolutePath());
		}
	}

	public void buscarDestino() {
		DirectoryChooser directoryChooser = new DirectoryChooser();
		directoryChooser.setTitle("Escolha um diretório de destino...");
		File file = directoryChooser.showDialog(null);
		if (file != null) {
			destino.setText(file.getAbsolutePath());
		}
	}

	public void gerarPatch() throws IOException, ParserConfigurationException,
			SAXException {
		File dirOrigem = new File(origem.getText());
		File dirDestino = new File(destino.getText());
		if (dirOrigem.exists()) {
			if (!dirDestino.exists()) {
				dirDestino.mkdir();
			}
			if (!dirOrigem.toString().equalsIgnoreCase(dirDestino.toString())) {
				ArquivoManagerBean arquivo = new ArquivoManagerBean();
				for (Log log : arquivo.GerarAtualizacao(origem.getText(), destino.getText())){
					listalog.add(log);
				}
				listaViewLogs.setItems(listalog);
				//this.barra();
				// RequestContext.getCurrentInstance().update("mainForm:log_ID");
				// FacesContext.getCurrentInstance().addMessage(
				// null,
				// new FacesMessage(FacesMessage.SEVERITY_INFO,
				// "Patch gerado com sucesso!", ""));
			} else {
				// FacesContext
				// .getCurrentInstance()
				// .addMessage(
				// null,
				// new FacesMessage(
				// FacesMessage.SEVERITY_ERROR,
				// "Atenção! Por favor digite diretórios diferentes!",
				// ""));
			}
		} else {
			if (!dirOrigem.exists()) {
				// FacesContext.getCurrentInstance().addMessage(
				// null,
				// new FacesMessage(FacesMessage.SEVERITY_ERROR,
				// "Atenção! Diretório origem não existe", ""));
			}
		}
	}

}
